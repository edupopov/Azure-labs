###################################################################################################################
# Estes passos o ajudarão a montar uma infra básica no Microsoft Azure a titulo de aprendizado                    #
# Autor: Eduardo Popovici - www.eduardopopovici.com                                                               #
# REF técnica - https://learn.microsoft.com/pt-br/previous-versions/azure/virtual-machines/linux/tutorial-monitor #
# Foco: AZ-900 e AZ-104                                                                                           #
# Tipo da VM: Linux                                                                                               #
# Sistema Operacional: Ubuntu                                                                                     #
# Data de criação: JAN-2023                                                                                       #
###################################################################################################################

# OBS - Estes passos entendem que você já instalou tanto o powershell quanto o modulo do azure em seu sistema operacional (Windows, Linux e/ou macOS)
# Caso você não tenha feito a instalação ainda, será necessário adequar seu sistema operacional para utilizar esta receita de criação.

# Faça o login no portal do Azure
az login

# Crie o grupo de recursos
az group create --name rg-az104-popov-eastus --location eastus

# Crie a VM
az vm create \
  --resource-group rg-az104-popov-eastus \
  --name vmlab01-LX \
  --image UbuntuLTS \
  --admin-username azureuser \
  --generate-ssh-keys
  
# Habilitar o diagnóstico de inicialização
storageacct=mydiagdata$RANDOM
az storage account create \
  --resource-group rg-az104-popov-eastus \
  --name $storageacct \
  --sku Standard_LRS \
  --location eastus
  
# Exibir a URI do contêiner de armazenamento de blobs
bloburi=$(az storage account show --resource-group rg-az104-popov-eastus --name $storageacct --query 'primaryEndpoints.blob' -o tsv)
  
# Habilitar o diagnóstico de inicialização
az vm boot-diagnostics enable \
  --resource-group rg-az104-popov-eastus \
  --name vmlab01-LX \
  --storage $bloburi

# IMPORTANTE --> Siga este documento para usar a Extensão de Diagnóstico do Linux 3.0 para monitorar métricas e logs refinados
# REF https://learn.microsoft.com/pt-br/azure/virtual-machines/extensions/diagnostics-linux-v3
